# Environment specific values
environments:
  # Mingyu TODO: remove the dev, test, staging blocks and add to the model resource once bundle supports overwriting the resource value.
  dev:
    resources:
      models:
        model:
          description: MLflow registered model for the "{{cookiecutter.project_name}}" ML Project for ${bundle.environment} environment.

  test:
    resources:
      models:
        model:
          description: MLflow registered model for the "{{cookiecutter.project_name}}" ML Project for ${bundle.environment} environment.

  staging:
    resources:
      models:
        model:
          description: MLflow registered model for the "{{cookiecutter.project_name}}" ML Project for ${bundle.environment} environment.

  prod:
    resources:
      models:
        model:
          description: |
            MLflow registered model for the "{{cookiecutter.project_name}}" ML Project. See the corresponding [Git repo]($#{var.git_repo_url}) for details on the project.
            
            Links:
              * [Git Repo]($#{var.git_repo_url}): contains ML code for the current project.
              * [Recurring model training job]({{cookiecutter.databricks_staging_workspace_host}}#job/${resources.jobs.model_training_job.id}): trains fresh model versions using the latest ML code.
              * [Recurring batch inference job]({{cookiecutter.databricks_staging_workspace_host}}#job/${resources.jobs.batch_inference_job.id}): applies the latest ${bundle.environment} model version for batch inference.

# The MLflow registered model name under which to register model versions for dev/staging/prod/test environment.
model_name: &model_name ${bundle.environment}-{{cookiecutter.model_name}}
# The name of the experiment to use during training or model validation for dev/staging/prod/test environment.
experiment_name: &experiment_name /${bundle.environment}-{{cookiecutter.experiment_base_name}}
# Allow users to read the model and experiment
permissions: &permissions
  permissions:
    - level: CAN_READ
      group_name: users

# Defines model and experiments

resources:
  models:
    model:
      name: *model_name
      <<: *permissions
      depends_on:
        - resources.jobs.model_training_job.id
        - resources.jobs.batch_inference_job.id

  experiments:
    experiment:
      name: *experiment_name
      <<: *permissions
      description: MLflow Experiment used to track runs for {{cookiecutter.project_name}} project.